<html lang="zh_Hans">
<head>
    {% load bootstrap3 %}
    {% bootstrap_css %}
    <!--{% bootstrap_javascript %}-->
    <title>版本管理</title>
</head>
<body role="document">
<!-- 导航栏 -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <a class="navbar-brand">测试报告发送装置</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                <li ><a href="/task/edition_manage/">产品版本</a></li>
                <li class="active" ><a href="/task/task_manage/">测试任务</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="#">{{user}}</a></li>
                <li><a href="/task/logout/">退出</a></li>
            </ul>
        </div>
    </div>
</nav>
<!--任务搜索表单-->
    <div style="width:2000px;margin:0 auto">
    <div class="page-header" style="padding-top: 55px;">
        <div id="navbar_1" class="navbar-collapse collapse">
            <!--<div style="float:left;width:3%;padding-top:8;">-->
                <!--<a href="{% url 'add_edit_button' 0 0 %}">-->
                    <!--<span class="btn btn-success">新增</span>-->
                <!--</a>-->
            <!--</div>-->
            <div style="float:left;width:97%">
                <form class="navbar-form" method="post" action="/task/search_task/">
                {% csrf_token %}
                    <div class="form-group">
                        <input name="task_name" type="text" placeholder="请输入名称" class="form-control">
                    </div>
                    <select name="environment" class="btn" style="border:1px solid #ccc;height:34px;">
                        <option value ="-1" style="font-size:15px;">请选择环境</option>
                        <option value ="测试环境" style="font-size:15px;">测试环境</option>
                        <option value ="正式环境" style="font-size:15px;">正式环境</option>
                        <option value ="开发环境" style="font-size:15px;">开发环境</option>
                    </select>
                    <select name="editstatus" class="btn" style="border:1px solid #ccc;height:34px;">
                        <option value =-1 style="font-size:15px;">请选择状态</option>
                        <option value =2 style="font-size:15px;">正在测试</option>
                        <option value =3 style="font-size:15px;">完成测试</option>
                    </select>
                    <button type="submit" class="btn btn-success">搜索</button>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- 任务列表 -->
    <div class="row" style="padding-top: 15px;width:2000px;margin:0 auto">
    <div class="col-md-12">
        <table class="table table-striped">
            <thead>
            <tr>
                <th>任务名称</th><th>当前版本</th><th>版本环境</th><th>创建时间</th><th>完成时间</th><th>状态</th><th>下载链接</th><th>操作</th>
            </tr>
            </thead>
            <tbody>
            {% for task in task_list %}
            <tr>
                <td>{{ task.taskName }}</td>
                <td>{{ task.editionNum }}</td>
                <td>{{ task.environment }}</td>
                <td>{{ task.createTime }}</td>
                <td>
                    {% if task.task_status != 2 %}
                        {{ task.lastTime }}
                    {% endif %}
                </td>
                <td>
                    {% if task.task_status == 2 %}
                    <span>正在测试</span>
                    {% elif task.task_status == 3 %}
                    <span>完成测试</span>
                    {% else %}
                    <span>已被关闭</span>
                    {% endif %}
                </td>
                <td>
                    <a href="{{ task.downloadLink }}" target="_blank">{{ task.downloadLink }}</a>
                </td>
                <td>
                    <a href="{% url 'add_task' task.edition_id task.id 0 %}">详情</a>
                    {% if task.task_status == 3 or task.task_status == 0 %}
                        <a style="display:none">修改</a>
                    {% else %}
                        <a href="{% url 'add_task' task.edition_id task.id 1 %}">修改</a>
                    {% endif %}
                    {% if task.task_status == 0 or task.task_status == 2 %}
                        <a style="display:none">关闭</a>
                    {% else %}
                        <a href="#">关闭</a>
                    {% endif %}
                    {% if task.task_status == 0 or task.task_status == 3 %}
                        <a style="display:none">提交结果</a>
                    {% elif personid not in task.actor %}
                        <a style="display:none">提交结果</a>
                    {% else %}
                        <a href="#">提交结果</a>
                    {% endif %}
                    {% if task.task_status == 2 %}
                        <a style="display:none">查看报告</a>
                    {% else %}
                        <a href="#">查看报告</a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
        {{error}}<br>
    </div>
</div>
</body>
</html>